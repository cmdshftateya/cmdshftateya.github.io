<!DOCTYPE html>
<html>
<head>
<title>Ayah of the Day</title>
</head>

<body>
    <h1>Ayah Printer</h1>
        <form id="ayahForm">
            <label for="surahNumber">Surah Number:</label><br>
            <input type="number" id="surahNumber" name="surahNumber"><br>
            <label for="ayahNumber">Ayah Number:</label><br>
            <input type="number" id="ayahNumber" name="ayahNumber"><br><br>
            <button type="submit" onclick="printAyah()">Print Ayah</button>
        </form> 
        <br>
        <div id="output"></div>
    
        <script>
            async function get_arabic_verse_text(surahNumber, ayahNumber) {
                const url = `https://api.quran.com/api/v4/quran/verses/uthmani?verse_key=${surahNumber}:${ayahNumber}`;
                const response = await fetch(url);
                console.log('response.status: ', response.status);
                const data = await response.json();
                console.log(data.verses[0].text_uthmani)
                return data.verses[0].text_uthmani;
            }
        </script>
        <script>
            async function get_english_verse_text(surahNumber, ayahNumber) {
                const url = `https://api.quran.com/api/v4/quran/translations/85?verse_key=${surahNumber}:${ayahNumber}`;
                const response = await fetch(url);
                const data = await response.json();
                console.log(data.translations[0].text)
                return data.translations[0].text;
            }
        </script>
        <script>
            function convert_to_arabic(num) {
                // Create an array of the Arabic digits
                const arabicDigits = ["٠", "١", "٢", "٣", "٤", "٥", "٦", "٧", "٨", "٩"];
            
                // Convert the input number to a string
                num = num.toString();
            
                // Replace each English digit with its corresponding Arabic digit
                for (let i = 0; i < num.length; i++) {
                num = num.replace(/\d/, arabicDigits[num[i]]);
                }
            
                // Return the converted number
                return num;
            }
        </script>
        <script>
            async function get_arabic(surah_number, ayah_number) {
                if (Number.isInteger(ayah_number)) {
                    console.log(await get_arabic_verse_text(surah_number, ayah_number));
                    return await get_arabic_verse_text(surah_number, ayah_number);
                } else {
                    const endcaps = ayah_number.split("-");
                    const start = parseInt(endcaps[0]);
                    const end = parseInt(endcaps[1]);

                    let verses = "";

                    for (let i = start; i < end + 1; i++) {
                        const verse = await get_arabic_verse_text(surah_number, i);
                        verses += verse + " (" + convert_to_arabic(i) + ") ";
                    }
                    console.log(verses)
                    return verses;
                }
            }
        </script>
        <script>
            async function get_english(surah_number, ayah_number) {
                if (Number.isInteger(ayah_number)) {
                    return await get_english_verse_text(surah_number, ayah_number);
                } else {
                    const endcaps = ayah_number.split("-");
                    const start = parseInt(endcaps[0]);
                    const end = parseInt(endcaps[1]);

                    let verses = "";

                    for (let i = start; i < end + 1; i++) {
                        const verse = await get_english_verse_text(surah_number, i);
                        verses += verse;
                    }
                    // console.log(verses)
                    return verses;
                }
            }
        </script>
        <script>
            async function surah_name_translation(surah_number) {
                const url = `https://api.quran.com/api/v4/chapters/${surah_number}?language=en`;
            
                const response = await fetch(url);
                const data = await response.json();
                return data.chapter.name_simple;
            }
        </script>
        <script>
            function is_first_letter_vowel(str) {
                // Convert the string to lowercase
                str = str.toLowerCase();
            
                // Check if the first letter is a vowel
                return str[0] === "a" || str[0] === "e" || str[0] === "i" || str[0] === "o" || str[0] === "u";
            }
        </script>
        <script>
            async function ayah_printer(surah_number, ayah_number) {  
                const d = new Date();
                const daydate = (d.getMonth() + 1) + "/" + d.getDate();
                // console.log(datetime);
                const arabic = await get_arabic(surah_number, ayah_number);
                console.log(arabic);
                const english = await get_english(surah_number, ayah_number);
                console.log(english);
                const surah_name = await surah_name_translation(surah_number);

                let surah_or_surat = "";
                if (is_first_letter_vowel(surah_name)) {
                    surah_or_surat = "Surat";
                } else {
                    surah_or_surat = "Surah";
                }
                const output = 
                    "Ayah of the Day, " +
                    daydate + "\n\n" + 
                    surah_or_surat + " " + surah_name + ", Ayah " + ayah_number +  "\n\n" + 
                    arabic +  "\n\n" +
                    english;
                
                console.log(output);
                return output;
            }
        </script>
        
        <script>
            async function printAyah() {
                event.preventDefault(); // prevent the form from submitting
                const surahNumber = document.getElementById('surahNumber').value;
                const ayahNumber = document.getElementById('ayahNumber').value;
                const output = await ayah_printer(surahNumber, ayahNumber);
                
                console.log(output);
                document.getElementById('output').innerHTML = output;
            }
        </script>

</body>
</html>